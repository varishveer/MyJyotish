<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1-on-1 Voice Call with ZEGOCLOUD</title>
       <script src="~/ZegoCloud/ZegoExpressWebRTC-3.7.4.js"></script> 
    <script src="https://unpkg.com/@@zegocloud/zego-uikit-prebuilt/zego-uikit-prebuilt.js"></script>

    <style>
        #zego-container{
            z-index:1000000000000 !important;
            width: 50vw !important;
            height: 50vh !important;
            position:fixed;
            left:20%;
        }

        #root {
            width: 50vw;
            height: 50vh;
            position: fixed;
            left: 20%;
        }
    </style>

</head>
<body>
    <h1>1-on-1 Voice Call</h1>
    <button onclick="startCall()">Start Call</button>
    <button onclick="acceptCall()">Accept Call</button>
    <button onclick="endCall()">End Call</button>
    <audio id="localAudio" autoplay muted></audio>
    <audio id="remoteAudio" autoplay></audio>
    <div id="root"></div>
    <script>
        // Initialize ZEGOCLOUD SDK
        const roomID = 'room01';
        const userID = Math.floor(Math.random() * 10000) + "";
        const userName = "userName" + userID;
        const appID = 865742206;
        const serverSecret = "5a72180880214f43c9358d38af32eacc";
        const TOKEN = ZegoUIKitPrebuilt.generateKitTokenForTest(appID, serverSecret, roomID, userID, userName);
       
        const zg = ZegoUIKitPrebuilt.create(TOKEN);

        async function startCall() {
            try {

                zg.joinRoom({
                    container: document.querySelector("#root"),
                    turnOnCameraWhenJoining: false,
                    showMyCameraToggleButton: false,
                    showAudioVideoSettingsButton: false,
                    showScreenSharingButton: false,
                    showPreJoinView: false,
                    scenario: {
                        mode: ZegoUIKitPrebuilt.OneONoneCall,
                       

                    }

                });
            } catch (error) {
                console.error('Error starting the call:', error);
            }
        }

        zg.on('roomStreamUpdate', (roomID, updateType, streamList) => {
            if (updateType === 'ADD') {
                const remoteUserID = streamList[0].userID;
                const remoteStream = streamList[0].stream;

                remoteStream.play('remoteAudio');
                console.log(`${remoteUserID} has joined the call and their stream is playing.`);
            }
        });

        async function acceptCall() {
            try {
                const incomingAudioTrack = await zg.createMicrophoneAudioTrack();
                await zg.publishStream(incomingAudioTrack);
                document.getElementById('remoteAudio').srcObject = incomingAudioTrack;

                console.log('Call accepted and audio is being published');
            } catch (error) {
                console.error('Error accepting the call:', error);
            }
        }

        async function endCall() {
            try {
                await zg.leaveRoom(roomID);
                console.log('Call ended and left the room.');
            } catch (error) {
                console.error('Error ending the call:', error);
            }
        }
    </script>
</body>
</html>
