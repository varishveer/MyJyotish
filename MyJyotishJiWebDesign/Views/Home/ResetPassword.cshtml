<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket 1-to-1 Client</title>
    <style>
        body { font-family: Arial, sans-serif; }
        #messages { margin-top: 10px; }
        .message { margin-bottom: 5px; }
    </style>
</head>
<body>
    <h1>WebSocket 1-to-1 Client</h1>
    <input type="text" id="clientId" value="1"  placeholder="Your ID (e.g., user1)" />
    <input type="text" id="sendBy"  placeholder="sendBy" value="client  "/>
    <input type="text" id="recipientId" value="2"  placeholder="Recipient ID" />
    <input type="text" id="messageInput" placeholder="Type a message..." />
    <button id="sendButton">Send Message</button>
    <button id="connectBtn">Connect</button>
    <div id="messages"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/web-socket-js/1.0.0/web_socket.min.js" integrity="sha512-jtr9/t8rtBf1Sv832XjG1kAtUECQCqFnTAJWccL8CSC82VGzkPPih8rjtOfiiRKgqLXpLA1H/uQ/nq2bkHGWTQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


    <script>
        let socket;
        document.getElementById("connectBtn").onclick = function () {
            const clientId = document.getElementById("clientId").value;
            const sendBy = document.getElementById("sendBy").value;

            // Validate inputs
            if (!clientId || !sendBy) {
                alert("Please enter both Client ID and Send By values.");
                return;
            }

            // Close existing socket if present
            if (socket) {
                socket.close();
            }

            // Create a new WebSocket connection
            socket = new WebSocket(`wss://localhost:7118/api/chat/connect?id=${clientId}&sendBy=${sendBy}`);

            socket.onopen = function (event) {
                console.log('WebSocket connection established:', event);
                const messagesDiv = document.getElementById('messages');
                messagesDiv.innerHTML += `<div class="message">Connected as ${clientId}.</div>`;
            };

            socket.onmessage = function (event) {
                const messagesDiv = document.getElementById('messages');
                messagesDiv.innerHTML += ` <div class="message">Received: ${JSON.parse(event.data).mssg}</div>`;
                console.log(JSON.parse(event.data))
            };

            socket.onerror = function (event) {
                console.error('WebSocket error observed:', event);
                alert('WebSocket error occurred. Check the console for details.');
            };

            socket.onclose = function (event) {
                console.log('WebSocket connection closed:', event);
                const messagesDiv = document.getElementById('messages');
                messagesDiv.innerHTML +=`<div class="message"> Connection closed. </div>`;
            };
        };

        document.getElementById('sendButton').onclick = function () {
            const recipientId = document.getElementById('recipientId').value;
            const message = document.getElementById('messageInput').value;

            if (socket && socket.readyState === WebSocket.OPEN) {
                if (recipientId && message) {
                    socket.send(`${recipientId}:${message}`);
                    document.getElementById('messageInput').value = ''; // Clear input
                } else {
                    alert("Please enter both recipient ID and message.");
                }
            } else {
                alert("WebSocket is not connected.");
            }
        };

    </script>
</body>
</html>