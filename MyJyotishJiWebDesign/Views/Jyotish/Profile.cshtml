@{
    Layout = "JyotishLayout";
   
}


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<style>
    body {
        font-family: 'Arial', sans-serif;
        background-color: #f4f7fa;
        color: #333;
    }

    .profile-container {
        max-width: 1170px;
        margin: 0 auto;
        padding: 20px;
        background: #ffffff;
        border-radius: 8px;
    }

    .profile-sidebar {
        background-color: #ffffff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 20px;
    }

        .profile-sidebar .profile-photo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 5px solid #fff;
            margin-bottom: 20px;
            object-fit: cover;
        }

        .profile-sidebar a {
            color: #007bff;
            text-decoration: none;
            margin: 10px 0;
            display: block;
            font-size: 16px;
            font-weight: 500;
            transition: color 0.3s;
        }

            .profile-sidebar a:hover {
                text-decoration: underline;
                color: #0056b3;
            }

   

    .section-title {
        font-size: 20px;
        margin-bottom: 15px;
        font-weight: 600;
        color: #007bff;
    }

    .row {
        margin-bottom: 15px;
    }

    .detail-label {
        font-weight: 500;
        color: #6c757d;
        font-size: 14px;
    }

    .detail-value {
        font-weight: 600;
        color: #495057;
        font-size: 14px;
    }

    .action-btns a {
        display: inline-block;
        margin-right: 10px;
        font-size: 14px;
        color: #007bff;
        transition: color 0.3s;
    }

        .action-btns a:hover {
            text-decoration: underline;
            color: #0056b3;
        }

    .left-part img {
        max-width: 100%;
        height: auto;
        border-radius: 10px;
        object-fit: cover;
    }

    .left-part {
        text-align: center;
        padding: 20px;
        background-color: white;
    }

        .left-part button {
            margin-top: 10px;
        }

        .left-part h6 {
            margin-top: 20px;
            font-weight: 600;
        }

    .form-check-label {
        font-size: 13px;
    }

    .form-check-input {
        margin-top: 3px;
    }

    .mb-3 button {
        margin-top: 10px;
        width: 100%;
        font-size: 14px;
    }

    /* Button styles */
    .btn-outline-danger {
        border-color: #dc3545;
        color: #dc3545;
        transition: background-color 0.3s, color 0.3s;
    }

        .btn-outline-danger:hover {
            background-color: #dc3545;
            color: white;
        }

    .btn-outline-primary {
        border-color: #007bff;
        color: #007bff;
        transition: background-color 0.3s, color 0.3s;
    }

        .btn-outline-primary:hover {
            background-color: #007bff;
            color: white;
        }

    .btn-outline-info {
        border-color: #17a2b8;
        color: #17a2b8;
        transition: background-color 0.3s, color 0.3s;
    }

        .btn-outline-info:hover {
            background-color: #17a2b8;
            color: white;
        }

    .btn-outline-secondary {
        border-color: #6c757d;
        color: #6c757d;
        transition: background-color 0.3s, color 0.3s;
    }

        .btn-outline-secondary:hover {
            background-color: #6c757d;
            color: white;
        }

    .laguage {
        font-size: 15px;
    }

    #about{
        text-align:justify !important;
    }
</style>


<div class="container profile-container mt-4">
    <div class="row">
        <!-- Left Sidebar -->
        <div class="col-md-4 rounded-start shadow-sm left-part">
            <div class="mb-3">
                <img id="profileImage" src="~/Img/UserPlaceholder.png" alt="Profile Image" class="profile-photo" width="140" height="140">
            </div>
            <h6 id="JyotishName"></h6>
            <div class="my-3 d-flex justify-content-center flex-wrap flex-row">
                <button class="btn btn-outline-info mx-1">
                    <a href="/Jyotish/UpdateProfile">Edit Profile</a>
                </button>
                <button class="btn btn-outline-primary" id="changePasswordBtn">Change Password</button>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <div class="detail-value">About</div>
                    <div class="detail-label" id="about"></div>
                </div>
            </div>
        </div>

        <!-- Right Profile Details -->
        <div class="col-md-8 rounded-start shadow-sm">
            <div class="p-2">
                <div class="section-title">Personal Details</div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="detail-label">Full Name</div>
                        <div class="detail-value" id="name"></div>
                    </div>
                    <div class="col-md-6">
                        <div class="detail-label">Email</div>
                        <div class="detail-value" id="email"></div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="detail-label">Phone</div>
                        <div class="detail-value" id="mobile"></div>
                    </div>
                    <div class="col-md-6">
                        <div class="detail-label">Alternate Phone</div>
                        <div class="detail-value" id="alternatemobile"></div>
                    </div>
                   
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="detail-label">Gender</div>
                        <div class="detail-value" id="gender"></div>
                    </div>
                    <div class="col-md-6">
                        <div class="detail-label">Languages</div>
                        <div class="detail-value" id="language"></div>
                    </div>
                   
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="detail-label">Appointment Time from</div>
                        <div class="detail-value" id="timeFrom"></div>
                    </div>
                    <div class="col-md-6">
                        <div class="detail-label">Appointment Time To</div>
                        <div class="detail-value" id="timeTo"></div>
                    </div>
                   
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="detail-label">Appointment Charges</div>
                        <div class="detail-value" id="appointmentCharges"></div>
                    </div>
                    <div class="col-md-6">
                        <div class="detail-label">Professional Experience</div>
                        <div class="detail-value" id="experience"></div>
                    </div>
                   
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="detail-label">Pooja</div>
                        <div class="detail-value" id="pooja"></div>
                    </div>
                    <div class="col-md-6">
                        <div class="detail-label">Chat Price</div>
                        <div class="detail-value" id="chatCharges"></div>
                    </div>
                  
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="detail-label">Call Price</div>
                        <div class="detail-value" id="callCharges"></div>
                    </div>
                    <div class="col-md-6">
                        <div class="detail-label">Address</div>
                        <div class="detail-value" id="address"></div>
                    </div>
                   
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="detail-label">Date Of Birth</div>
                        <div class="detail-value" id="dateOfBirth"></div>
                    </div>
                    <div class="col-md-6">
                        <div class="detail-label">City</div>
                        <div class="detail-value" id="city"></div>
                    </div>
                  
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="detail-label">State</div>
                        <div class="detail-value" id="state"></div>
                    </div>
                    <div class="col-md-6">
                        <div class="detail-label">Country</div>
                        <div class="detail-value" id="country"></div>
                    </div>
                  
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="detail-label">Expertise</div>
                        <div class="detail-value" id="expertise"></div>
                    </div>
                    <div class="col-md-6">
                        <div class="detail-label">Specialization</div>
                        <div class="detail-value" id="specialization"></div>
                    </div>
                   
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="detail-label">Awards and Achievements</div>
                        <div class="detail-value" id="awardsAndAchievement"></div>
                    </div>
                </div>
               
            </div>
        </div>
    </div>
</div>


<script>
   
        var Id = localStorage.getItem('Id'); // Assuming Id is stored in localStorage
        let allAbout;
        let cropAbout;
        debugger
         Swal.fire({
            title: "Processing Your Request",
            allowOutsideClick: false,
            didOpen: () => {
                Swal.showLoading();
            }
        })
        $.ajax({
            url: BaseUrl + `api/jyotish/GetProfile`,
            type: 'GET',
            headers: {
                'Authorization': `Bearer ${localStorage.getItem("Token2")}`,
                'Content-Type': 'application/json',
            },
            data:{Id:Id},
            success: function (response) {
                if (response.status === 200) {
                    var profile = response.data;
                    console.log(profile)
                    // Fill in the data fields
                    $('#profileImage').attr('src', profile.profileImage ?  BaseUrl+profile.profileImage : 'default-image.jpg');
                    $('#JyotishName').html(profile.name + " <i class='fas text-primary fa-check-circle'></i>");
                    $('#name').text(profile.name || "NA");
                    $('#email').text(profile.email || "NA");
                $('#mobile').text(profile.mobile || "NA");
                $('#alternatemobile').text(profile.alternateMobile || "NA");
                $('#role').text(profile.role || "NA");
                $('#gender').text(profile.gender || "NA");
                $('#expertise').text(profile.expertise || "NA");
                $('#city').text(profile.cityName || "NA");
                $('#state').text(profile.stateName || "NA");
                $('#country').text(profile.countryName || "NA");
                $('#language').text(profile.language || "NA");
                $('#experience').text(profile.experience || "NA");
                $('#specialization').text(profile.specialization || "NA");
                $('#about').html(profile.about.slice(0, 200) + `...<span class='text-primary' onClick='SeemoreAbout()' role='button'>more</span>`);
                    $('#awardsAndAchievement').text(profile.awordsAndAchievement || 'N/A');
                $('#callCharges').text("₹" + profile.callCharges + "/min" || "NA");
                $('#chatCharges').text("₹" + profile.chatCharges + "/min" || "NA");
                   const dateOfBirth = profile.dateOfBirth.split('T')[0];
                $('#dateOfBirth').text(dateOfBirth || "NA");
                $('#pooja').text(profile.pooja?"Yes":"No" || 'No');
                $('#appointmentCharges').text(profile.appointmentCharges || "NA");
                $('#address').text(profile.address || "NA");
                $('#timeTo').text(profile.timeTo || "NA");

                $('#timeFrom').text(profile.timeFrom || "NA");
                    allAbout = profile.about;
                    // Handle timeFrom and timeTo if necessary
                    } else {
                   
                    Swal.fire({
                        title: 'Error: Could not load profile.',
                        icon: "warning",
                        text:"some error occured",
                        showConfirmButton: true, 
                  
                    });
                }
                Swal.close();
            },
            error: function (xhr, status, error) {
                console.error('Error:', error);
                Swal.fire({
                    title: 'There was an error fetching the profile data.',
                    icon: "warning",
                    text:"some error occured",
                    showConfirmButton: true, 

                });
            }
        });
      function SeemoreAbout(){
            cropAbout=$("#about").html()
          $("#about").html(
              `
                      ${allAbout} <span class='text-primary' onClick='SeelessAbout()' role='button'>less</span>
              `
          )
      }
      function SeelessAbout(){
            $("#about").html(cropAbout)
      }

    $("#profileImage").on('error', function () {
        $(this).attr("src", '/user-not-found.png');
    });
</script>

<script>
      $("#changePasswordBtn").click(function() {
        Swal.fire({
            title: 'Change Your Password',
            html: `
                <div class="form-group mb-0 text-start">
                    <label for="oldPassword">Old Password</label>
                    <input id="oldPassword" class="form-control" type="password" placeholder="Old Password" autocomplete="off" required>
                </div>
                <div class="form-group mb-0 text-start">
                    <label for="newPassword">New Password</label>
                    <input id="newPassword" class="form-control" type="password" placeholder="New Password" autocomplete="off" required>
                </div>
                <div class="form-group mb-0 text-start">
                    <label for="confirmPassword">Confirm New Password</label>
                    <input id="confirmPassword" class="form-control" type="password" placeholder="Confirm New Password" autocomplete="off" required>
                </div>
            `,
            showCancelButton: true,
            confirmButtonText: 'Submit',
            cancelButtonText: 'Cancel',
            focusConfirm: false, // Keep focus on the input fields rather than the confirm button
            preConfirm: () => {
                const oldPassword = $('#oldPassword').val();
                const newPassword = $('#newPassword').val();
                const confirmPassword = $('#confirmPassword').val();

                // Validate if all fields are filled
                if (!oldPassword || !newPassword || !confirmPassword) {
                    Swal.showValidationMessage('Please fill out all fields');
                    return false;
                }

                // Validate if new password matches confirm password
                if (newPassword !== confirmPassword) {
                    Swal.showValidationMessage('New password and confirm password do not match');
                    return false;
                }

                // Optional: Add additional password strength validation here (e.g. length, special chars, etc.)

                return { oldPassword, newPassword };
            },
            customClass: {
                popup: 'custom-swal-popup',
                input: 'custom-swal-input',
                confirmButton: 'btn btn-primary custom-swal-confirm',
                cancelButton: 'btn btn-secondary custom-swal-cancel',
            },
            padding: '20px'
        }).then((result) => {
            if (result.isConfirmed) {
                const { oldPassword, newPassword } = result.value;

                Swal.fire({
                    title: "Processing Your Request",
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });

                // Make AJAX request to change password
                $.ajax({
                    url: BaseUrl + 'api/account/changePasswordByOldPassword', // Replace with your server endpoint
                    type: 'get', // Changed to POST for better security
                    data: {
                        oldpassword: oldPassword,
                        Password: newPassword,
                        userId: localStorage.getItem("Id"),
                        sendBy: "jyotish"
                    },
                    success: function(response) {
                        if (response.status === 200) {
                            Swal.fire('Success', 'Your password has been changed successfully!', 'success');
                        } else {
                            Swal.fire('Error', response.message || 'Something went wrong. Please try again later.', 'error').then(()=>{
                                 $("#changePasswordBtn").click();
                            });

                        }
                    },
                    error: function() {
                        Swal.fire('Error', 'Something went wrong while changing your password. Please try again.', 'error').then(()=>{
                                 $("#changePasswordBtn").click();

                        });
                    }
                });
            }
        });
    });

</script>