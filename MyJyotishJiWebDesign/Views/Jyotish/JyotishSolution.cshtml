@{
    Layout = "JyotishLayout";
}


<style>
 


    .content-container {
        max-width: 800px;
        margin: 20px auto;
        padding: 20px;
        border-radius: 8px;
        background-color: #f7f7f7;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .header {
        text-align: center;
        margin-bottom: 20px;
    }

    .problem-solution-container {
        margin-top: 15px;
    }

    .section-title {
        font-weight: bold;
        color: #333;
        margin-bottom: 5px;
    }

    .modal-dialog-fullscreen {
        max-width: 100%;
        height: 100vh;
        margin: 0;
    }

    .modal-content {
        height: 100%;
    }
</style>

<div class="content-container">
    <div class="header">
        <h2>Problem and Solution Viewer</h2>
        <p>View the details of the problem and its solutions</p>
    </div>
    <div id="problemSolutionContent">
        <!-- Data will be injected here -->
    </div>
</div>

<script>
    $(document).ready(function () {
        function getIdFromParams(paramName) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(paramName);
        }
        const id = getIdFromParams('id'); 

        $.ajax({
            url: BaseUrl+`Api/Jyotish/GetProblemSolution?id=${id}`,
            method: "GET",
            headers: {
                'Authorization': `Bearer ${localStorage.getItem("Token2")}`,
                'Content-Type': 'application/json',
            },
            success: function (response) {
                if (response.status === 200) {
                    const data = response.data;
                    const content = `
                            <div class="problem-solution-container">
                                <div class="section-title">User Name:</div>
                                <p>${data.userName}</p>
                                <div class="section-title">User Email:</div>
                                <p>${data.userEmail}</p>
                                <div class="section-title">Problems:</div>
                                <ul>${data.problem.map(problem => `<li>${problem}</li>`).join('')}</ul>
                                <div class="section-title">Solutions:</div>
                                <ul>${data.solution.map(solution => `<li>${solution}</li>`).join('')}</ul>
                            </div>
                        `;
                    $('#problemSolutionContent').html(content);
                } else {
                    $('#problemSolutionContent').html('<div class="container my-3"> <a class="btn btn-success" data-bs-toggle="modal" data-bs-target="#problemSolutionModal">Add</a>  </div > ');
                }
            },
            error: function () {
                $('#problemSolutionContent').html('<p>There was an error loading the data.</p>');
            }
        });
    });
</script>



<div class="modal fade" id="problemSolutionModal" tabindex="-1" aria-labelledby="problemSolutionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-fullscreen">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="problemSolutionModalLabel">Add Problem and Solution</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="container-fluid">
                    <div class="row">
                        <!-- Column for Problems -->
                        <div class="col-md-6">
                            <h6>Problem(s)</h6>
                            <div id="problemFields">
                                <div class="mb-3">
                                    <input type="text" class="form-control" name="Problem[]" placeholder="Enter problem">
                                </div>
                            </div>
                            <button type="button" class="btn btn-secondary mb-3" onclick="addProblemField()">Add More Problem</button>
                        </div>

                        <!-- Column for Solutions -->
                        <div class="col-md-6">
                            <h6>Solution(s)</h6>
                            <div id="solutionFields">
                                <div class="mb-3">
                                    <input type="text" class="form-control" name="Solution[]" placeholder="Enter solution">
                                </div>
                            </div>
                            <button type="button" class="btn btn-secondary mb-3" onclick="addSolutionField()">Add More Solution</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="saveData()">Save</button>
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>



<script>
    // Function to dynamically add new problem fields
    function addProblemField() {
        const problemFields = document.getElementById('problemFields');
        const newField = document.createElement('div');
        newField.className = 'mb-3';
        newField.innerHTML = `<input type="text" class="form-control" name="Problem[]" placeholder="Enter problem">`;
        problemFields.appendChild(newField);
    }

    // Function to dynamically add new solution fields
    function addSolutionField() {
        const solutionFields = document.getElementById('solutionFields');
        const newField = document.createElement('div');
        newField.className = 'mb-3';
        newField.innerHTML = `<input type="text" class="form-control" name="Solution[]" placeholder="Enter solution">`;
        solutionFields.appendChild(newField);
    }

    // Function to save data - you can implement this to handle form submission or API calls
    function saveData() {
        const problems = Array.from(document.querySelectorAll('input[name="Problem[]"]')).map(input => input.value);
        const solutions = Array.from(document.querySelectorAll('input[name="Solution[]"]')).map(input => input.value);

        console.log("Problems:", problems);
        console.log("Solutions:", solutions);

        const data = {
            AppointmentId: appointmentId,
            Problem: problems,
            Solution: solutions
        };

        $.ajax({
            url: BaseUrl+'Api/Jyotish/AddProblemSolution',  // Replace with actual API URL
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(data),
            success: function (response) {
                if (response.Status === 200) {
                    alert('Data saved successfully!');
                    $('#problemSolutionModal').modal('hide');  // Close modal on success
                    $('#problemSolutionForm')[0].reset();      // Reset form fields
                } else {
                    alert('Error: ' + response.Message);
                }
            },
            error: function (error) {
                console.error('Error:', error);
                alert('An error occurred while saving data. Please try again.');
            }
        });
        // Add your AJAX or form submission logic here
    }
</script>