@{
    Layout = "JyotishLayout";
   
}
<!-- Link to Bootstrap CSS -->



<style>
    body {
        margin: 0;
        font-family: "Heebo", sans-serif;
        font-size: 1rem;
        font-weight: 400;
        line-height: 1.5;
        color: #757575;
        background-color: #F3F6F9;
    }
    .gallery-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
       
    }
    .gallery-item {
        border: 1px solid #ddd;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    .gallery-item img {
        width: 100%;
        height: auto;
    }
    .gallery-title {
        padding: 10px;
        text-align: center;
        font-weight: bold;
    }
</style>

<div class="container mt-4">
    <div class="d-flex justify-content-between">
        <h4 class="text-primary font-weight-bold">Gallery</h4>
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#AddModal">
            Add
        </button>
    </div>
   
    <hr />
    <!-- Button to open the modal -->
    
    <div class="gallery-container" id="galleryContainer">
        <!-- Images will be dynamically loaded here -->
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        // Get the ID from the URL
       
         
        var ApiUrl = BaseUrl + "Api/Jyotish/JyotishGallery?Id=" + `${localStorage.getItem("Id")}`;
        console.log(ApiUrl);
        // Fetch gallery data based on the ID
        $.ajax({
            url: ApiUrl,
            type: 'GET',
            headers: {
                'Authorization': `Bearer ${localStorage.getItem("Token2")}`,
                'Content-Type': 'application/json',
            },
            success: function (res) {
                 
                if (res.status === 200) {
                    const galleryData = res.data;
                  
                    galleryData.forEach(item => {
                        var src = BaseUrl + item.imageUrl
                        $('#galleryContainer').append(`
                            <div class="gallery-item col-md-3">
                                    <img src= "${src}" alt="${item.imageTitle}" style="width:250px; height:250px;">
                                <div class="gallery-title">${item.imageTitle}</div>
                            </div>
                        `);
                    });
                } else {
                     
                    console.error("Failed to load gallery data:", res.message);
                }
            },
            error: function (error) {
                 
                console.error('An error occurred while loading gallery data:', error);
            }
        });
    });
</script>



<!-- Modal -->
<div class="modal fade" id="AddModal" tabindex="-1" role="dialog" aria-labelledby="AddModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="AddModalLabel">Add Image</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>

            </div>
            <div class="modal-body">
                <form id="AddForm">
                    <input type="hidden" id="imageId" name="Id" />

                    <div class="form-group">
                        <label for="image">Image </label>
                        <input type="File" class="form-control" id="image" name="Image" required />
                    </div>

                    <div class="form-group">
                        <label for="imageTitle">Image Title</label>
                        <input type="text" class="form-control" id="imageTitle" name="ImageTitle" required />
                    </div>

                    <div class="form-group">
                        <label for="serialNo">Serial Number</label>
                        <input type="number" class="form-control" id="serialNo" name="SerialNo" required />
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        // Handle form submission for the modal
        $('#AddForm').on('submit', function (e) {
            e.preventDefault(); // Prevent default form submission
             
            // Gather individual field values
            var imageFile = $('#image')[0].files[0]; // Get the file object
            var imageTitle = $('#imageTitle').val();
            var serialNo = $('#serialNo').val();
            var jyotishId = localStorage.getItem('Id');

            // Create a FormData object for the file upload
            var formData = new FormData();
            formData.append('ImageUrl', imageFile);
            formData.append('ImageTitle', imageTitle);
            formData.append('SerialNo', serialNo);
            formData.append('JyotishId', jyotishId);

            // Define the API endpoint for adding an image
            var addImageUrl = BaseUrl + "Api/Jyotish/AddJyotishGallery"; // Adjust this to your actual API endpoint

            // Make AJAX request to submit the form
            $.ajax({
                url: addImageUrl,
                type: 'POST',
                data: formData,
                processData: false, // Important for file uploads
                contentType: false, // Important for file uploads
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem("Token2")}`,
                },
                success: function (response) {
                     
                    if (response.status === 200) {
                        location.reload(); // Reload the page or refresh the gallery
                        $('#AddModal').modal('hide'); // Close the modal
                        $('#AddForm')[0].reset(); // Reset the form
                    } else {
                        console.error("Failed to add image:", response.message);
                    }
                },
                error: function (xhr) {
                     
                    console.error('An error occurred while adding the image:', xhr);
                    console.error('Status:', xhr.status);
                    console.error('Response Text:', xhr.responseText);
                }
            });
        });
    });
</script>
