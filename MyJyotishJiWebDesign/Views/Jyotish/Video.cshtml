@{
    Layout = "AdminLayout";

}
<!-- Link to Bootstrap CSS -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<style>
    .gallery-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 15px;
    }

    .gallery-item {
        border: 1px solid #ddd;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

        .gallery-item img {
            width: 100%;
            height: auto;
        }

    .gallery-title {
        padding: 10px;
        text-align: center;
        font-weight: bold;
    }
</style>

<div class="container mt-4">
    <div class="row justify-content-around">
        <h4 class="text-primary font-weight-bold">Video</h4>
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#AddModal">
            Add
        </button>
    </div>

    <hr />
    <div class="gallery-container" id="galleryContainer">
        <!-- Images will be dynamically loaded here -->
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        var ApiUrl = BaseUrl + "Api/Jyotish/JyotishVideos?Id=" + localStorage.getItem("Id");

        $.ajax({
            url: ApiUrl,
            type: 'GET',
            headers: {
                'Authorization': `Bearer ${localStorage.getItem("Token2")}`,
                'Content-Type': 'application/json',
            },
            success: function (res) {
                if (res.status === 200) {
                    const galleryData = res.data;

                    galleryData.forEach(item => {
                        if (item.imageUrl == "") { var src = BaseUrl + "Image/UserPlaceholder.png" }
                        else { var src = BaseUrl + item.imageUrl; }
                        
                        $('#galleryContainer').append(`
                               <a href="${item.videoUrl}">
                                   <div class="gallery-item col-md-3">
                                        <img src="${src}" alt="${item.videoTitle}" width="250" height="250">
                                        <div class="gallery-title">${item.videoTitle}</div>
                                    </div>
                                </a>
                            `);
                    });
                } else {
                    console.error("Failed to load gallery data:", res.message);
                    alert("Error loading data. Please try again later.");
                }
            },
            error: function (error) {
                console.error('An error occurred while loading gallery data:', error);
                alert("An error occurred. Please check your connection and try again.");
            }
        });
    });
</script>



<!-- Modal -->
<div class="modal fade" id="AddModal" tabindex="-1" role="dialog" aria-labelledby="AddModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="AddModalLabel">Add Image</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="AddForm">
                    <input type="hidden" id="imageId" name="Id" />

                    <div class="form-group">
                        <label for="image">Image </label>
                        <input type="File" class="form-control" id="image" name="Image" required />
                    </div>

                    <div class="form-group">
                        <label for="videoTitle">Video Title</label>
                        <input type="text" class="form-control" id="videoTitle" name="videoTitle" required />
                    </div>

                    <div class="form-group">
                        <label for="serialNo">Serial Number</label>
                        <input type="number" class="form-control" id="serialNo" name="SerialNo" required />
                    </div>

                    <div class="form-group">
                        <label for="videoUrl">Video Url</label>
                        <input type="text" class="form-control" id="videoUrl" name="videoUrl" required />
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        // Handle form submission for the modal
        $('#AddForm').on('submit', function (e) {
            e.preventDefault(); // Prevent default form submission

            // Gather individual field values
            var imageFile = $('#image')[0].files[0]; // Get the file object
            var videoTitle = $('#videoTitle').val(); // Get the video title
            var serialNo = $('#serialNo').val(); // Get the serial number
            var videoUrl = $('#videoUrl').val(); // Get the video URL
            var jyotishId = localStorage.getItem('Id'); // Get JyotishId from local storage

            // Create a FormData object for the file upload
            var formData = new FormData();
            formData.append('Image', imageFile);
            formData.append('VideoTitle', videoTitle); // Changed to match the input name
            formData.append('SerialNo', serialNo);
            formData.append('VideoUrl', videoUrl); // Added the video URL
            formData.append('JyotishId', jyotishId); // Append JyotishId

            // Define the API endpoint for adding an image
            var addImageUrl = BaseUrl + "Api/Jyotish/AddJyotishVideo"; // Adjust this to your actual API endpoint

            // Make AJAX request to submit the form
            $.ajax({
                url: addImageUrl,
                type: 'POST',
                data: formData,
                processData: false, // Important for file uploads
                contentType: false, // Important for file uploads
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem("Token2")}`,
                },
                success: function (response) {
                    if (response.status === 200) {
                        location.reload(); // Reload the page or refresh the gallery
                        $('#AddModal').modal('hide'); // Close the modal
                        $('#AddForm')[0].reset(); // Reset the form
                    } else {
                        console.error("Failed to add image:", response.message);
                    }
                },
                error: function (xhr) {
                    console.error('An error occurred while adding the image:', xhr);
                    console.error('Status:', xhr.status);
                    console.error('Response Text:', xhr.responseText);
                }
            });
        });
    });
</script>
