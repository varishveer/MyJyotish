
@{
    Layout = "AdminLayout";
}
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

<style>
    body {
        margin: 0;
        font-family: "Heebo", sans-serif;
        color: #757575;
        background-color: #F3F6F9;
        -webkit-text-size-adjust: 100%;
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
    }

    .container {
        margin-top: 30px;
        margin-bottom: 50px;
    }

    .right-part {
        border-radius: 10px;
        box-shadow: 0px 0px 3px 0px rgba(0, 0, 0, 0.2);
        padding: 30px;
        background-color: white;
    }

    .responsive-image {
        max-width: 100%;
        height: auto;
        border-radius: 10px;
    }

    h2 {
        margin-bottom: 20px;
        color: #007BFF;
        text-align: center;
    }

    .btn-primary {
        border-radius: 6px;
    }


    .form-label {
        margin-bottom: 0.1rem;
        font-size: 15px;
    }

    .form-control {
        font-size: 12px;
    }

    .form-select {
        font-size: 12px;
    }

    .btn:not(:disabled):not(.disabled) {
        font-size: 12px;
    }

    .otpcolour {
        color: white;
        background-color: lightslategray;
    }

    /* Ensuring all form elements are consistently spaced */
    .form-row {
        margin-bottom: 1rem;
    }

    .col-md-6 {
        padding: 0 1rem;
    }


    .form-group {
        margin-bottom: 0;
    }

</style>


<div class="container">
    <div class="row">
        <div class="col-md-12 right-part">
            <h2>Update Appointment</h2>
            <form id="registrationForm">
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="jyotishId" class="form-label">ID:</label>
                        <input type="text" class="form-control" id="id" readonly>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="jyotishName" class="form-label">Name:</label>
                        <input type="text" class="form-control" id="name">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="jyotishEmail" class="form-label">Email:</label>
                        <input type="email" class="form-control" id="email">
                    </div>
                    <div class="form-group col-md-6">
                        <label for="jyotishMobile" class="form-label">Mobile:</label>
                        <input type="text" class="form-control" id="mobile">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="DateTime" class="form-label">DateTime:</label>
                        <input type="text" class="form-control" id="DateTime">
                    </div>
                    <div class="form-group col-md-6">
                        <label for="JyotishId" class="form-label">JyotishId:</label>
                        <input type="text" class="form-control" id="JyotishId">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="UserId" class="form-label">UserId:</label>
                        <input type="text" class="form-control" id="UserId">
                    </div>
                    <div class="form-group col-md-6">
                        <label for="Problem" class="form-label">Problem:</label>
                        <input type="text" class="form-control" id="Problem">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="Solution" class="form-label">Solution:</label>
                        <input type="text" class="form-control" id="Solution">
                    </div>
                    <div class="form-group col-md-6">
                        <label for="Status" class="form-label">Status:</label>
                        <input type="text" class="form-control" id="Status">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group col-md-12">
                        <label for="Amount" class="form-label">Amount:</label>
                        <input type="number" class="form-control" id="Amount">
                    </div>
                
                </div>
            

                <button type="submit" id="updateJyotishButton" class="btn btn-primary px-4">Update</button>
            </form>
        </div>
    </div>
</div>






<script>

    $(document).ready(function () {
        // Function to get the URL parameter
        function getUrlParam(param) {
            var searchParams = new URLSearchParams(window.location.search);
            return searchParams.get(param);
        }

        // Get 'Id' from the URL
        var id = getUrlParam('Id');
        $('#Id').val(id);  // Set the input field with the 'Id'

        // Make AJAX call only if 'Id' is present
        if (id) {
            $.ajax({
                url:BaseUrl + 'Admin/AppointmentDetail', // Replace with your API endpoint
                type: 'GET',
                data: { Id: id }, // Pass the Id as a query parameter
                success: function (response) {
                    if (response.Status === 200) {
                        // Assuming the API returns an object with properties like name, mobile, etc.
                        var record = response.data;

                        // Load the data into the form fields
                        $('#Name').val(record.name);
                        $('#Mobile').val(record.mobile);
                        $('#DateTime').val(record.dateTime);
                        $('#Email').val(record.email);
                        $('#JyotishId').val(record.jyotishId);
                        $('#UserId').val(record.userId);
                        $('#Problem').val(record.problem);
                        $('#Solution').val(record.solution);
                        $('#Status').val(record.status);
                        $('#Amount').val(record.amount);
                    } else {
                        $('#result').html('<p>' + response.Message + '</p>');
                    }
                },
                error: function (xhr, status, error) {
                    $('#result').html('<p>Error fetching details: ' + error + '</p>');
                }
            });
        } else {
            $('#result').html('<p>No Id provided in the URL.</p>');
        }
    });


    document.getElementById('updateButton').addEventListener('click', async function () {
        // Get form data
        const formData = {
            Id: parseInt(document.getElementById('Id').value, 10),

            Name: document.getElementById('Name').value,
            Mobile: document.getElementById('Mobile').value,
            DateTime: new Date(document.getElementById('DateTime').value).toISOString(), // Convert to ISO string
            Email: document.getElementById('Email').value,
            JyotishId: parseInt(document.getElementById('JyotishId').value, 10),
            UserId: parseInt(document.getElementById('UserId').value, 10),
            Problem: document.getElementById('Problem').value,
            Solution: document.getElementById('Solution').value,
            Status: document.getElementById('Status').value,
            Amount: parseInt(document.getElementById('Amount').value, 10)
        };

        try {
            const response = await fetch( BaseUrl 'api/Admin/UpdateAppointment', {
                method: 'POST', // Use 'PUT' if updating an existing resource
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem("Token")}`, // Example authorization header
                    'Content-Type': 'application/json' // Header indicating JSON payload
                },
                body: JSON.stringify(formData) // Convert form data to JSON
            });

            if (response.status === 200) {
                const result = await response.json();
                alert('Request updated successfully!');
                console.log(result);
                $('#updateModal').modal('hide'); // Close the modal
                window.location.reload();

            } else {
                alert('Failed to update request.');
                console.error('Error:', response.statusText);
            }
        } catch (error) {
            console.error('Error:', error);
            alert('An error occurred while updating the request.');
        }
    });
</script>