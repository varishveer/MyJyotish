@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    Layout ="AdminLayout"; 
}
<div class="outerDiv col-md-6">

    <button id="getDocuments" class="btn btn-primary">Get All Jyotish Documents</button>

    <div id="documentsList" class="mt-4">
        <!-- Documents will be displayed here -->
    </div>

    <!-- Rejection Modal -->
    <div id="rejectionModal" class="modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Reason for Rejection</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <textarea id="rejectionReason" class="form-control" rows="4" placeholder="Enter reason for rejection"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" id="confirmReject" class="btn btn-danger">Reject</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        let selectedDocument;

        $('#getDocuments').click(function () {
            const token = localStorage.getItem("Token");
            debugger;
            $.ajax({
                url: 'https://localhost:7118/Api/Admin/GetAllJyotishDocument',
                type: 'GET',
                contentType: 'application/json',
                headers: {
                    'Authorization': 'Bearer ' + token
                },
                success: function (response) {
                    debugger;
                    if (response.status === 200) {
                        displayDocuments(response.data);
                    } else {
                        alert('Error: ' + response.message);
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error:', error);
                    alert('There was an error fetching the documents.');
                }
            });
        });

        function displayDocuments(documents) {
            var html = '<ul class="list-group">';
            documents.forEach(function (document) {
                html += `<li class="list-group-item">
                            <strong>ID:</strong> ${document.Id} <br>
                            <strong>ID Proof:</strong> ${document.IdProof || 'N/A'} <br>
                            <strong>Address Proof:</strong> ${document.AddressProof || 'N/A'} <br>
                            <strong>Tenth Certificate:</strong> ${document.TenthCertificate || 'N/A'} <br>
                            <strong>Twelve Certificate:</strong> ${document.TwelveCertificate || 'N/A'} <br>
                            <strong>Professional Certificate:</strong> ${document.ProfessionalCertificate || 'N/A'} <br>
                            <button class="btn btn-success approve" data-id="${document.Id}" data-jid="${document.JId}" data-image-id="${document.ImageId}">Approve</button>
                            <button class="btn btn-danger reject" data-id="${document.Id}" data-jid="${document.JId}" data-image-id="${document.ImageId}">Reject</button>
                        </li>`;
            });
            html += '</ul>';
            $('#documentsList').html(html);
        }

        // Approve button handler
        $(document).on('click', '.approve', function () {
            const id = $(this).data('id');
            const jid = $(this).data('jid');
            const imageId = $(this).data('image-id');

            // Call approve API
            $.ajax({
                url: 'https://localhost:7118/Api/Account/ApproveDocument', // Update with the correct API endpoint
                type: 'POST',
                contentType: 'application/json',
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem("Token")
                },
                data: JSON.stringify({ Id: id, JId: jid, ImageId: imageId }),
                success: function (response) {
                    alert('Document approved successfully.');
                    $('#getDocuments').click(); // Refresh the document list
                },
                error: function (xhr, status, error) {
                    console.error('Error:', error);
                    alert('There was an error approving the document.');
                }
            });
        });

        // Reject button handler
        $(document).on('click', '.reject', function () {
            selectedDocument = {
                Id: $(this).data('id'),
                JId: $(this).data('jid'),
                ImageId: $(this).data('image-id')
            };
            $('#rejectionModal').modal('show'); // Show the rejection modal
        });

        // Confirm rejection
        $('#confirmReject').click(function () {
            const reason = $('#rejectionReason').val();
            if (!reason) {
                alert('Please enter a reason for rejection.');
                return;
            }

            // Call reject API
            $.ajax({
                url: 'https://localhost:7118/Api/Account/RejectDocument', // Update with the correct API endpoint
                type: 'POST',
                contentType: 'application/json',
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem("Token")
                },
                data: JSON.stringify({
                    Id: selectedDocument.Id,
                    JId: selectedDocument.JId,
                    ImageId: selectedDocument.ImageId,
                    Message: reason
                }),
                success: function (response) {
                    alert('Document rejected successfully.');
                    $('#rejectionModal').modal('hide'); // Close the modal
                    $('#rejectionReason').val(''); // Clear the input
                    $('#getDocuments').click(); // Refresh the document list
                },
                error: function (xhr, status, error) {
                    console.error('Error:', error);
                    alert('There was an error rejecting the document.');
                }
            });
        });
    });



</script>













































