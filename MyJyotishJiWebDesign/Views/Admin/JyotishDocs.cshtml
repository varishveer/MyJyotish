@{
    Layout = "AdminLayout";
}
<style>
    td, th {
        white-space: nowrap; /* Prevent text from wrapping */
    }

    thead, th {
        background-color: rgba(63, 175, 165, 0.85);
        color: white;
        font-weight: 300 !important;
        text-align: center !important;
    }
</style>
<link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
<!-- Include jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<div class="container">
    <h6>Jyotish Documents</h6>
    <div id="loading" style="display:none;">Loading...</div>
    <table id="DataTable" class="table">
        <thead>
            <tr>
                <th>Id</th>
                <th>Id Proof</th>
                <th>Id Proof Status</th>
                <th>Address Proof</th>
                <th>Address Proof Status</th>
                <th>Tenth Certificate</th>
                <th>Tenth Certificate Status</th>
                <th>Twelve Certificate</th>
                <th>Twelve Certificate Status</th>
                <th>Professional Certificate</th>

                <th>Professional Certificate Status</th>
            </tr>
        </thead>
        <tbody>
            <!-- Data will be populated here by JavaScript -->
        </tbody>
    </table>
</div>

<script>
    $(document).ready(function () {
        // Function to get query parameter by name
        function getQueryParameter(name) {
            const params = new URLSearchParams(window.location.search);
            return params.get(name);
        }
        debugger;
        // Extract the id from the URL
        const id = getQueryParameter('id');

        function fetchData() {
            debugger;
            if (!id) {
                console.error('ID parameter is missing in the URL.');
                return; // Exit if id is not defined
            }
            $('#loading').show(); // Show loading indicator

            $.ajax({
                url: BaseUrl + `api/Admin/GetJyotishDocs?id=${id}`, // Use the extracted id
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem("Token")}`,
                    'Content-Type': 'application/json'
                },
                success: function (result) {
                    debugger;
                    $('#loading').hide(); // Hide loading indicator

                    if (!result.data) {
                        alert('No data found for the provided ID.');
                        return;
                    }

                    // Extract the single record from the response
                    const record = result.data;

                    // Populate the table with data
                    $('#DataTable tbody').append(`
                            <tr>
                                <td>${record.id}</td>
                                        <td><img src= ${BaseUrl} +"${record.idProof}" alt="Id Proof" style="max-width: 100px;"></td>
                                    <td><p>${record.idProofStatus}</p>
                                            <svg class="approve" data-imageStatus="IdProofStatus" data-JyotishId="${record.jId}" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 48 48"><path fill="#2f88ff" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M4 24L9 19L19 29L39 9L44 14L19 39L4 24Z" clip-rule="evenodd"/></svg>

                                                <svg class="reject" data-imageStatus="IdProofStatus" data-JyotishId="${record.jId}" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M18.36 19.78L12 13.41l-6.36 6.37l-1.42-1.42L10.59 12L4.22 5.64l1.42-1.42L12 10.59l6.36-6.36l1.41 1.41L13.41 12l6.36 6.36z"/></svg>
                                    </td>
                                        <td><img src= ${BaseUrl} +"${record.addressProof}" alt="Address Proof" style="max-width: 100px;"></td>
                                      <td><p>${record.addressProofStatus}</p>
                                            <svg class="approve" data-imageStatus="AddressProofStatus" data-JyotishId="${record.jId}" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 48 48"><path fill="#2f88ff" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M4 24L9 19L19 29L39 9L44 14L19 39L4 24Z" clip-rule="evenodd"/></svg>

                                                <svg class="reject" data-imageStatus="AddressProofStatus" data-JyotishId="${record.jId}" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M18.36 19.78L12 13.41l-6.36 6.37l-1.42-1.42L10.59 12L4.22 5.64l1.42-1.42L12 10.59l6.36-6.36l1.41 1.41L13.41 12l6.36 6.36z"/></svg>
                                    </td>
                                        <td><img src= ${BaseUrl}+"${record.tenthCertificate}" alt="Tenth Certificate" style="max-width: 100px;"></td>
                                      <td><p>${record.tenthCertificateStatus}</p>
                                            <svg class="approve" data-imageStatus="TenthCertificateStatus" data-JyotishId="${record.jId}" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 48 48"><path fill="#2f88ff" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M4 24L9 19L19 29L39 9L44 14L19 39L4 24Z" clip-rule="evenodd"/></svg>

                                                            <svg class="reject" data-imageStatus="TenthCertificateStatus" data-JyotishId="${record.jId}" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M18.36 19.78L12 13.41l-6.36 6.37l-1.42-1.42L10.59 12L4.22 5.64l1.42-1.42L12 10.59l6.36-6.36l1.41 1.41L13.41 12l6.36 6.36z"/></svg>
                                    </td>
                                            <td><img src= "${BaseUrl}"+"${record.twelveCertificate}" alt="Twelve Certificate" style="max-width: 100px;"></td>
                                      <td><p>${record.twelveCertificateStatus}</p>
                                                        <svg class="approve" data-imageStatus="TwelveCertificateStatus" data-JyotishId="${record.jId}" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 48 48"><path fill="#2f88ff" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M4 24L9 19L19 29L39 9L44 14L19 39L4 24Z" clip-rule="evenodd"/></svg>

                                                            <svg class="reject" data-imageStatus="TwelveCertificateStatus" data-JyotishId="${record.jId}" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M18.36 19.78L12 13.41l-6.36 6.37l-1.42-1.42L10.59 12L4.22 5.64l1.42-1.42L12 10.59l6.36-6.36l1.41 1.41L13.41 12l6.36 6.36z"/></svg>
                                        </td>
                                        <td><img src="${BaseUrl}"+"${record.professionalCertificate}" alt="Professional Certificate" style="max-width: 100px;"></td>
                                              <td><p>${record.professionalCertificateStatus}</p>
                                                        <svg class="approve" data-imageStatus="ProfessionalCertificateStatus" data-JyotishId="${record.jId}" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 48 48"><path fill="#2f88ff" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M4 24L9 19L19 29L39 9L44 14L19 39L4 24Z" clip-rule="evenodd"/></svg>

                                                            <svg class="reject" data-imageStatus="ProfessionalCertificateStatus" data-JyotishId="${record.jId}" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M18.36 19.78L12 13.41l-6.36 6.37l-1.42-1.42L10.59 12L4.22 5.64l1.42-1.42L12 10.59l6.36-6.36l1.41 1.41L13.41 12l6.36 6.36z"/></svg>
                                        </td>
                            </tr>
                        `);
                },
                error: function (errormessage) {
                    debugger;
                    $('#loading').hide(); // Hide loading indicator
                    console.error('Error fetching data:', errormessage.responseText);
                    alert('An error occurred while fetching data. Please try again later.');
                }
            });
        }

        // Load data if the id is defined
        fetchData();
    });
</script>

<script>

        $(document).ready(function () {

            debugger;
             const Token = localStorage.getItem('Token');
        // Event handler for approve button clicks
        $('#DataTable').on('click', '.approve', function () {
              debugger;
            let imageStatus = $(this).data('imagestatus');
            let jyotishId = $(this).data('jyotishid');

            // Create the data object to send to the server
            let data = {
                jyotishId: jyotishId,  // ID of the Jyotish to be updated
                imageStatus: imageStatus // Type of document being approved
            };

            // Send a POST request to the ApproveDocument API endpoint
            fetch(BaseUrl +'Api/Admin/ApproveDocument', { // Replace with your actual API endpoint
                method: 'POST',
                headers: {
                      'Authorization': `Bearer ${Token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data) // Convert data object to JSON string
            })
                .then(response => response.json())
                .then(data => {
                      debugger;
                    // Handle the response from the server
                    if (data.status === 200) {
                        alert(`Approval Successful for Jyotish ID: ${jyotishId}`);
                          location.reload();
                        // Optional: Update UI based on approval success
                    } else {
                        alert(`Approval failed: ${data.Message}`);
                    }
                })
                .catch(error => {
                      debugger;
                    console.error('Error:', error);
                    alert('Approval request failed');
                });
        });

        // Event handler for reject button clicks
        $('#DataTable').on('click', '.reject', function () {
            let imageStatus = $(this).data('imagestatus');
            let jyotishId = $(this).data('jyotishid');
              debugger;
            // Create the data object to send to the server
            let data = {
                jyotishId: jyotishId,  // ID of the Jyotish to be updated
                imageStatus: imageStatus // Type of document being rejected
            };

            // Send a POST request to the RejectDocument API endpoint
            fetch(BaseUrl + 'Api/Admin/RejectDocument', { // Replace with your actual API endpoint
                method: 'POST',
                headers: {
                      'Authorization': `Bearer ${Token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data) // Convert data object to JSON string
            })
                .then(response => response.json())
                .then(data => {
                      debugger;
                    // Handle the response from the server
                    if (data.status === 200) {
                        alert(`Rejection Successful for Jyotish ID: ${jyotishId}`);
                        location.reload();
                        // Optional: Update UI based on rejection success
                    } else {
                        alert(`Rejection failed: ${data.Message}`);
                    }
                })
                .catch(error => {
                      debugger;
                    console.error('Error:', error);
                    alert('Rejection request failed');
                });
        });
    });

</script>